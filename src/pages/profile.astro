---
import '@/styles/globals.css';
import { getSession } from 'auth-astro/server';

import Layout from '../layouts/Layout.astro';
import { db } from '../utils/db';
import { eq, sql } from 'drizzle-orm';
import { polls } from '@/models/schema';
import { UserProfile } from '../components/Profile';
import SiteLayout from '@/layouts/SiteLayout.astro';
const session = await getSession(Astro.request);
if (!session?.user) return Astro.redirect('/api/auth/signin');

const userPolls = await db.query.polls.findMany({
  where: eq(polls.creatorId, session.user!.id),
  with: {
    options: true
  }
});
---

<SiteLayout currentPage="profile" title="Your Profile">
  <UserProfile polls={userPolls} />
</SiteLayout>
